<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summary Bulanan - Admin Billing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .summary-card {
            transition: transform 0.2s;
            border-left: 4px solid #007bff;
            height: 100%;
        }
        .summary-card:hover {
            transform: translateY(-2px);
        }
        .card {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: none;
        }
        .card-body {
            padding: 1.25rem;
        }
        .stat-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .stat-item:last-child {
            margin-bottom: 0;
        }
        .month-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .stat-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .revenue-positive {
            color: #28a745;
            font-weight: bold;
        }
        .revenue-negative {
            color: #dc3545;
            font-weight: bold;
        }
        .chart-container {
            height: 300px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .trend-up {
            color: #28a745;
        }
        .trend-down {
            color: #dc3545;
        }
        .trend-stable {
            color: #6c757d;
        }
        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 0;
            height: 100%;
        }
        .kpi-row {
            margin-bottom: 0;
        }
        .kpi-col {
            margin-bottom: 15px;
        }
        .growth-indicator {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: bold;
        }
        .growth-positive {
            background: #d4edda;
            color: #155724;
        }
        .growth-negative {
            background: #f8d7da;
            color: #721c24;
        }
        .growth-neutral {
            background: #e2e3e5;
            color: #383d41;
        }
        .chart-container {
            height: 300px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .row {
            margin-left: -15px;
            margin-right: -15px;
        }
        .col-xl-4, .col-xl-6, .col-xl-8, .col-lg-6, .col-md-12, .col-12 {
            padding-left: 15px;
            padding-right: 15px;
        }
        .mb-4 {
            margin-bottom: 1.5rem !important;
        }
        .mb-3 {
            margin-bottom: 1rem !important;
        }
        .card-body.d-flex {
            min-height: 400px;
        }
        .stat-item {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .stat-item h4, .stat-item h5 {
            margin-bottom: 0;
        }
        .stat-item h6 {
            margin-bottom: 0.5rem;
        }
        .bg-primary {
            background-color: #007bff !important;
        }
        .text-white {
            color: #fff !important;
        }
        .chart-section {
            margin-bottom: 2rem;
        }
        .chart-card {
            height: 400px;
        }
        .chart-card .card-body {
            height: calc(100% - 60px);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .chart-card canvas {
            max-height: 100%;
            max-width: 100%;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <%- include('../../partials/billing-sidebar') %>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">
                        <i class="bx bx-calendar"></i> Summary Bulanan
                    </h1>
                    <div>
                        <a href="/admin/billing/export/monthly-summary.xlsx" class="btn btn-warning me-2">
                            <i class="bx bx-download"></i> Export Excel
                        </a>
                        <button id="generateSummaryBtn" class="btn btn-success me-2" onclick="generateSummary()">
                            <i class="bx bx-plus"></i> Generate Summary Bulan Ini
                        </button>
                        <a href="/admin/billing/dashboard" class="btn btn-outline-primary">
                            <i class="bx bx-arrow-back"></i> Kembali ke Dashboard
                        </a>
                    </div>
                </div>

                <!-- Info Card -->
                <div class="alert alert-info">
                    <i class="bx bx-info-circle me-2"></i>
                    <strong>Info:</strong> Summary bulanan akan otomatis di-generate setiap tanggal 1 pukul 23:59. 
                    Data summary ini akan disimpan sebagai catatan keuangan dan tidak akan ter-reset.
                </div>

                <!-- KPI Overview -->
                <div class="row mb-4" id="kpiOverview">
                    <div class="col-12">
                        <div class="kpi-card">
                            <h4 class="mb-3"><i class="bx bx-trending-up"></i> Analisis Trend 12 Bulan Terakhir</h4>
                            <div class="row kpi-row">
                                <div class="col-md-3 kpi-col">
                                    <div class="metric-card">
                                        <h6 class="text-muted mb-1">Total Revenue Growth</h6>
                                        <h4 class="mb-0" id="revenueGrowth">-</h4>
                                        <small id="revenueGrowthIndicator" class="growth-indicator">-</small>
                                    </div>
                                </div>
                                <div class="col-md-3 kpi-col">
                                    <div class="metric-card">
                                        <h6 class="text-muted mb-1">Customer Growth</h6>
                                        <h4 class="mb-0" id="customerGrowth">-</h4>
                                        <small id="customerGrowthIndicator" class="growth-indicator">-</small>
                                    </div>
                                </div>
                                <div class="col-md-3 kpi-col">
                                    <div class="metric-card">
                                        <h6 class="text-muted mb-1">Avg Monthly Revenue</h6>
                                        <h4 class="mb-0" id="avgRevenue">-</h4>
                                        <small class="text-muted">12 bulan terakhir</small>
                                    </div>
                                </div>
                                <div class="col-md-3 kpi-col">
                                    <div class="metric-card">
                                        <h6 class="text-muted mb-1">Best Month</h6>
                                        <h4 class="mb-0" id="bestMonth">-</h4>
                                        <small class="text-muted">Revenue tertinggi</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Revenue Analysis -->
                <div class="row chart-section" id="revenueAnalysis">
                    <div class="col-xl-8 mb-3">
                        <div class="card chart-card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bx bx-line-chart"></i> Trend Pendapatan 12 Bulan Terakhir
                                </h5>
                            </div>
                            <div class="card-body">
                                <canvas id="revenueChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 mb-3">
                        <div class="card chart-card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bx bx-pie-chart"></i> Distribusi Revenue
                                </h5>
                            </div>
                            <div class="card-body">
                                <canvas id="revenueDistributionChart" width="300" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer & Invoice Analysis -->
                <div class="row chart-section" id="customerInvoiceAnalysis">
                    <div class="col-xl-6 mb-3">
                        <div class="card chart-card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bx bx-group"></i> Trend Pelanggan
                                </h5>
                            </div>
                            <div class="card-body">
                                <canvas id="customerChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-6 mb-3">
                        <div class="card chart-card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bx bx-receipt"></i> Invoice Performance
                                </h5>
                            </div>
                            <div class="card-body">
                                <canvas id="invoiceChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary List -->
                <div class="row">
                    <% if (summaries && summaries.length > 0) { %>
                        <% summaries.forEach(function(summary) { %>
                            <div class="col-xl-4 col-lg-6 col-md-12 mb-4">
                                <div class="card summary-card h-100">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="bx bx-calendar"></i> 
                                            <%= new Date(summary.year, summary.month - 1).toLocaleDateString('id-ID', { year: 'numeric', month: 'long' }) %>
                                        </h5>
                                        <small class="text-muted">
                                            Dibuat: <%= new Date(summary.created_at).toLocaleDateString('id-ID') %>
                                        </small>
                                    </div>
                                    <div class="card-body d-flex flex-column">
                                        <!-- Customer Stats -->
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <div class="stat-item">
                                                    <h6 class="text-primary mb-1">Total Pelanggan</h6>
                                                    <h4 class="mb-0"><%= summary.total_customers %></h4>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="stat-item">
                                                    <h6 class="text-success mb-1">Pelanggan Aktif</h6>
                                                    <h4 class="mb-0"><%= summary.active_customers %></h4>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Invoice Stats -->
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <div class="stat-item">
                                                    <h6 class="text-info mb-1">Tagihan Bulanan</h6>
                                                    <h5 class="mb-0"><%= summary.monthly_invoices %></h5>
                                                    <small class="text-muted">
                                                        Lunas: <%= summary.paid_monthly_invoices %> | 
                                                        Belum: <%= summary.unpaid_monthly_invoices %>
                                                    </small>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="stat-item">
                                                    <h6 class="text-warning mb-1">Tagihan Voucher</h6>
                                                    <h5 class="mb-0"><%= summary.voucher_invoices %></h5>
                                                    <small class="text-muted">
                                                        Lunas: <%= summary.paid_voucher_invoices %> | 
                                                        Belum: <%= summary.unpaid_voucher_invoices %>
                                                    </small>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Revenue Stats -->
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <div class="stat-item">
                                                    <h6 class="text-success mb-1">Pendapatan Bulanan</h6>
                                                    <h5 class="revenue-positive mb-0">
                                                        Rp <%= summary.monthly_revenue.toLocaleString('id-ID') %>
                                                    </h5>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="stat-item">
                                                    <h6 class="text-info mb-1">Pendapatan Voucher</h6>
                                                    <h5 class="revenue-positive mb-0">
                                                        Rp <%= summary.voucher_revenue.toLocaleString('id-ID') %>
                                                    </h5>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Total Revenue -->
                                        <div class="mt-auto">
                                            <div class="stat-item bg-primary text-white">
                                                <h6 class="mb-1">Total Pendapatan</h6>
                                                <h4 class="mb-0">
                                                    Rp <%= summary.total_revenue.toLocaleString('id-ID') %>
                                                </h4>
                                            </div>

                                            <!-- Notes -->
                                            <% if (summary.notes) { %>
                                                <div class="mt-2">
                                                    <small class="text-muted">
                                                        <i class="bx bx-note"></i> <%= summary.notes %>
                                                    </small>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="col-12">
                            <div class="text-center py-5">
                                <i class="bx bx-calendar-x" style="font-size: 4rem; color: #6c757d;"></i>
                                <h4 class="mt-3 text-muted">Belum Ada Summary Bulanan</h4>
                                <p class="text-muted">Summary akan otomatis di-generate setiap tanggal 1, atau Anda bisa generate manual.</p>
                                <button class="btn btn-success" onclick="generateSummary()">
                                    <i class="bx bx-plus"></i> Generate Summary Pertama
                                </button>
                            </div>
                        </div>
                    <% } %>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Data dari server
        const summariesData = <%- JSON.stringify(summaries || []) %>;
        
        // Inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            if (summariesData && summariesData.length > 0) {
                initializeAnalytics();
                showAnalyticsSections();
            }
        });

        // Tampilkan section analisis jika ada data
        function showAnalyticsSections() {
            console.log('Showing analytics sections, data length:', summariesData.length);
            if (summariesData.length >= 1) {
                const kpiOverview = document.getElementById('kpiOverview');
                const revenueAnalysis = document.getElementById('revenueAnalysis');
                const customerInvoiceAnalysis = document.getElementById('customerInvoiceAnalysis');
                
                if (kpiOverview) {
                    kpiOverview.style.display = 'block';
                    console.log('KPI Overview shown');
                }
                if (revenueAnalysis) {
                    revenueAnalysis.style.display = 'block';
                    console.log('Revenue Analysis shown');
                }
                if (customerInvoiceAnalysis) {
                    customerInvoiceAnalysis.style.display = 'block';
                    console.log('Customer Invoice Analysis shown');
                }
            }
        }

        // Inisialisasi analisis dan grafik
        function initializeAnalytics() {
            if (summariesData.length < 1) return;

            // Ambil data 12 bulan terakhir
            const recentData = summariesData.slice(0, 12).reverse();
            
            // Hitung KPI
            calculateKPIs(recentData);
            
            // Buat grafik
            createRevenueChart(recentData);
            createRevenueDistributionChart(recentData);
            createCustomerChart(recentData);
            createInvoiceChart(recentData);
        }

        // Hitung KPI
        function calculateKPIs(data) {
            if (data.length < 1) return;

            // Revenue Growth
            if (data.length >= 2) {
                const latestRevenue = data[data.length - 1].total_revenue;
                const previousRevenue = data[data.length - 2].total_revenue;
                const revenueGrowth = ((latestRevenue - previousRevenue) / previousRevenue * 100).toFixed(1);
                
                document.getElementById('revenueGrowth').textContent = revenueGrowth + '%';
                const revenueIndicator = document.getElementById('revenueGrowthIndicator');
                if (revenueGrowth > 0) {
                    revenueIndicator.textContent = '↗ ' + revenueGrowth + '%';
                    revenueIndicator.className = 'growth-indicator growth-positive';
                } else if (revenueGrowth < 0) {
                    revenueIndicator.textContent = '↘ ' + revenueGrowth + '%';
                    revenueIndicator.className = 'growth-indicator growth-negative';
                } else {
                    revenueIndicator.textContent = '→ ' + revenueGrowth + '%';
                    revenueIndicator.className = 'growth-indicator growth-neutral';
                }
            } else {
                document.getElementById('revenueGrowth').textContent = 'N/A';
                document.getElementById('revenueGrowthIndicator').textContent = 'Data tunggal';
                document.getElementById('revenueGrowthIndicator').className = 'growth-indicator growth-neutral';
            }

            // Customer Growth
            if (data.length >= 2) {
                const latestCustomers = data[data.length - 1].total_customers;
                const previousCustomers = data[data.length - 2].total_customers;
                const customerGrowth = ((latestCustomers - previousCustomers) / previousCustomers * 100).toFixed(1);
                
                document.getElementById('customerGrowth').textContent = customerGrowth + '%';
                const customerIndicator = document.getElementById('customerGrowthIndicator');
                if (customerGrowth > 0) {
                    customerIndicator.textContent = '↗ ' + customerGrowth + '%';
                    customerIndicator.className = 'growth-indicator growth-positive';
                } else if (customerGrowth < 0) {
                    customerIndicator.textContent = '↘ ' + customerGrowth + '%';
                    customerIndicator.className = 'growth-indicator growth-negative';
                } else {
                    customerIndicator.textContent = '→ ' + customerGrowth + '%';
                    customerIndicator.className = 'growth-indicator growth-neutral';
                }
            } else {
                document.getElementById('customerGrowth').textContent = 'N/A';
                document.getElementById('customerGrowthIndicator').textContent = 'Data tunggal';
                document.getElementById('customerGrowthIndicator').className = 'growth-indicator growth-neutral';
            }

            // Average Revenue
            const avgRevenue = data.reduce((sum, item) => sum + item.total_revenue, 0) / data.length;
            document.getElementById('avgRevenue').textContent = 'Rp ' + avgRevenue.toLocaleString('id-ID');

            // Best Month
            const bestMonth = data.reduce((max, item) => item.total_revenue > max.total_revenue ? item : max);
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            document.getElementById('bestMonth').textContent = monthNames[bestMonth.month - 1] + ' ' + bestMonth.year;
        }

        // Grafik Trend Pendapatan
        function createRevenueChart(data) {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            const labels = data.map(item => {
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                return monthNames[item.month - 1] + ' ' + item.year;
            });


            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Revenue',
                        data: data.map(item => item.total_revenue),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Monthly Revenue',
                        data: data.map(item => item.monthly_revenue),
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Voucher Revenue',
                        data: data.map(item => item.voucher_revenue),
                        borderColor: '#ffc107',
                        backgroundColor: 'rgba(255, 193, 7, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Rp ' + value.toLocaleString('id-ID');
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': Rp ' + context.parsed.y.toLocaleString('id-ID');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Grafik Distribusi Revenue
        function createRevenueDistributionChart(data) {
            const ctx = document.getElementById('revenueDistributionChart').getContext('2d');
            const latest = data[data.length - 1];
            
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Monthly Revenue', 'Voucher Revenue'],
                    datasets: [{
                        data: [latest.monthly_revenue, latest.voucher_revenue],
                        backgroundColor: ['#28a745', '#ffc107'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': Rp ' + context.parsed.toLocaleString('id-ID') + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Grafik Trend Pelanggan
        function createCustomerChart(data) {
            const ctx = document.getElementById('customerChart').getContext('2d');
            const labels = data.map(item => {
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                return monthNames[item.month - 1];
            });


            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Customers',
                        data: data.map(item => item.total_customers),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#667eea',
                        borderWidth: 1
                    }, {
                        label: 'Active Customers',
                        data: data.map(item => item.active_customers),
                        backgroundColor: 'rgba(40, 167, 69, 0.8)',
                        borderColor: '#28a745',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Grafik Invoice Performance
        function createInvoiceChart(data) {
            const ctx = document.getElementById('invoiceChart').getContext('2d');
            const labels = data.map(item => {
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                return monthNames[item.month - 1];
            });


            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Paid Invoices',
                        data: data.map(item => item.paid_monthly_invoices + item.paid_voucher_invoices),
                        backgroundColor: 'rgba(40, 167, 69, 0.8)',
                        borderColor: '#28a745',
                        borderWidth: 1
                    }, {
                        label: 'Unpaid Invoices',
                        data: data.map(item => item.unpaid_monthly_invoices + item.unpaid_voucher_invoices),
                        backgroundColor: 'rgba(220, 53, 69, 0.8)',
                        borderColor: '#dc3545',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Fungsi untuk generate summary bulanan
        async function generateSummary() {
            const btn = document.getElementById('generateSummaryBtn');
            const originalText = btn.innerHTML;
            
            // Disable button dan show loading
            btn.disabled = true;
            btn.innerHTML = '<i class="bx bx-loader-alt bx-spin me-1"></i>Generating...';
            
            try {
                const response = await fetch('/admin/billing/api/generate-monthly-summary', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show success message
                    showAlert('success', 'Berhasil!', result.message);
                    
                    // Reload page setelah 2 detik
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                } else {
                    showAlert('danger', 'Error!', result.message);
                }
            } catch (error) {
                showAlert('danger', 'Error!', 'Gagal generate summary: ' + error.message);
            } finally {
                // Restore button
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // Fungsi untuk menampilkan alert
        function showAlert(type, title, message) {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <strong>${title}:</strong> ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // Insert alert di atas content
            const mainContent = document.querySelector('.main-content');
            const firstChild = mainContent.firstElementChild;
            firstChild.insertAdjacentHTML('afterend', alertHtml);
            
            // Auto dismiss setelah 5 detik
            setTimeout(() => {
                const alert = document.querySelector('.alert');
                if (alert) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 5000);
        }
    </script>
</body>
</html>
